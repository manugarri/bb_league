{% extends "base.html" %}

{% block title %}{% if get_locale() == 'es' %}Estadísticas de Jugadores{% else %}Player Stats{% endif %} - {{ _('Blood Bowl League Tracker') }}{% endblock %}

{% block content %}
<nav aria-label="breadcrumb" class="mb-4">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{{ url_for('matches.index') }}">{{ _('Matches') }}</a></li>
        <li class="breadcrumb-item"><a href="{{ url_for('matches.view', match_id=match.id) }}">{{ match.home_team.name }} vs {{ match.away_team.name }}</a></li>
        <li class="breadcrumb-item active">{% if get_locale() == 'es' %}Estadísticas de Jugadores{% else %}Player Stats{% endif %}</li>
    </ol>
</nav>

<h1 class="mb-4"><i class="bi bi-person-lines-fill text-gold me-2"></i>{% if get_locale() == 'es' %}Registrar Estadísticas de Jugadores{% else %}Record Player Statistics{% endif %}</h1>

<!-- Match Summary -->
<div class="alert alert-info mb-4">
    <div class="row text-center align-items-center">
        <div class="col-md-5">
            <strong>{{ match.home_team.name }}</strong>
        </div>
        <div class="col-md-2">
            <span class="badge bg-dark fs-5">{{ match.home_score }} - {{ match.away_score }}</span>
        </div>
        <div class="col-md-5">
            <strong>{{ match.away_team.name }}</strong>
        </div>
    </div>
</div>

<form method="POST">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    
    <div class="row g-4">
        <!-- Home Team Players -->
        <div class="col-lg-6">
            <div class="card">
                <div class="card-header">
                    <i class="bi bi-house me-2"></i>{{ match.home_team.name }} ({% if get_locale() == 'es' %}Local{% else %}Home{% endif %})
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-sm mb-0">
                            <thead>
                                <tr>
                                    <th>{% if get_locale() == 'es' %}Jugador{% else %}Player{% endif %}</th>
                                    <th class="text-center" style="width: 50px;">TD</th>
                                    <th class="text-center" style="width: 50px;">{% if get_locale() == 'es' %}BAJ{% else %}CAS{% endif %}</th>
                                    <th class="text-center" style="width: 50px;">{% if get_locale() == 'es' %}PAS{% else %}CMP{% endif %}</th>
                                    <th class="text-center" style="width: 50px;">INT</th>
                                    <th class="text-center" style="width: 50px;">MVP</th>
                                    <th style="width: 120px;">{% if get_locale() == 'es' %}Lesión{% else %}Injury{% endif %}</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for player in home_players %}
                                {% set stat = existing_stats.get(player.id) %}
                                <tr>
                                    <td>
                                        <small class="text-muted">#{{ player.number or '?' }}</small>
                                        {{ player.name }}
                                        <br><small class="text-muted">{{ tr_position(player.position.name) }}</small>
                                    </td>
                                    <td>
                                        <input type="number" name="player_{{ player.id }}_touchdowns" 
                                            class="form-control form-control-sm text-center" 
                                            value="{{ stat.touchdowns if stat else 0 }}" min="0" max="10">
                                    </td>
                                    <td>
                                        <input type="number" name="player_{{ player.id }}_casualties" 
                                            class="form-control form-control-sm text-center" 
                                            value="{{ stat.casualties_inflicted if stat else 0 }}" min="0" max="10">
                                    </td>
                                    <td>
                                        <input type="number" name="player_{{ player.id }}_completions" 
                                            class="form-control form-control-sm text-center" 
                                            value="{{ stat.completions if stat else 0 }}" min="0" max="20">
                                    </td>
                                    <td>
                                        <input type="number" name="player_{{ player.id }}_interceptions" 
                                            class="form-control form-control-sm text-center" 
                                            value="{{ stat.interceptions if stat else 0 }}" min="0" max="10">
                                    </td>
                                    <td class="text-center">
                                        <input type="checkbox" name="player_{{ player.id }}_mvp" 
                                            class="form-check-input" 
                                            {% if stat and stat.is_mvp %}checked{% endif %}>
                                    </td>
                                    <td>
                                        <select name="player_{{ player.id }}_injury" class="form-select form-select-sm">
                                            <option value="">{% if get_locale() == 'es' %}Ninguna{% else %}None{% endif %}</option>
                                            <option value="badly_hurt" {% if stat and stat.injury_result == 'badly_hurt' %}selected{% endif %}>{% if get_locale() == 'es' %}Mal Herido{% else %}Badly Hurt{% endif %}</option>
                                            <option value="miss_next_game" {% if stat and stat.injury_result == 'miss_next_game' %}selected{% endif %}>{% if get_locale() == 'es' %}Pierde Partido{% else %}MNG{% endif %}</option>
                                            <option value="niggling" {% if stat and stat.injury_result == 'niggling' %}selected{% endif %}>{% if get_locale() == 'es' %}Lesión Persistente{% else %}Niggling{% endif %}</option>
                                            <option value="-1ma" {% if stat and stat.injury_result == '-1ma' %}selected{% endif %}>-1 MA</option>
                                            <option value="-1av" {% if stat and stat.injury_result == '-1av' %}selected{% endif %}>-1 AV</option>
                                            <option value="-1ag" {% if stat and stat.injury_result == '-1ag' %}selected{% endif %}>-1 AG</option>
                                            <option value="-1st" {% if stat and stat.injury_result == '-1st' %}selected{% endif %}>-1 ST</option>
                                            <option value="dead" {% if stat and stat.injury_result == 'dead' %}selected{% endif %}>{% if get_locale() == 'es' %}Muerto{% else %}Dead{% endif %}</option>
                                        </select>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Away Team Players -->
        <div class="col-lg-6">
            <div class="card">
                <div class="card-header">
                    <i class="bi bi-airplane me-2"></i>{{ match.away_team.name }} ({% if get_locale() == 'es' %}Visitante{% else %}Away{% endif %})
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-sm mb-0">
                            <thead>
                                <tr>
                                    <th>{% if get_locale() == 'es' %}Jugador{% else %}Player{% endif %}</th>
                                    <th class="text-center" style="width: 50px;">TD</th>
                                    <th class="text-center" style="width: 50px;">{% if get_locale() == 'es' %}BAJ{% else %}CAS{% endif %}</th>
                                    <th class="text-center" style="width: 50px;">{% if get_locale() == 'es' %}PAS{% else %}CMP{% endif %}</th>
                                    <th class="text-center" style="width: 50px;">INT</th>
                                    <th class="text-center" style="width: 50px;">MVP</th>
                                    <th style="width: 120px;">{% if get_locale() == 'es' %}Lesión{% else %}Injury{% endif %}</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for player in away_players %}
                                {% set stat = existing_stats.get(player.id) %}
                                <tr>
                                    <td>
                                        <small class="text-muted">#{{ player.number or '?' }}</small>
                                        {{ player.name }}
                                        <br><small class="text-muted">{{ tr_position(player.position.name) }}</small>
                                    </td>
                                    <td>
                                        <input type="number" name="player_{{ player.id }}_touchdowns" 
                                            class="form-control form-control-sm text-center" 
                                            value="{{ stat.touchdowns if stat else 0 }}" min="0" max="10">
                                    </td>
                                    <td>
                                        <input type="number" name="player_{{ player.id }}_casualties" 
                                            class="form-control form-control-sm text-center" 
                                            value="{{ stat.casualties_inflicted if stat else 0 }}" min="0" max="10">
                                    </td>
                                    <td>
                                        <input type="number" name="player_{{ player.id }}_completions" 
                                            class="form-control form-control-sm text-center" 
                                            value="{{ stat.completions if stat else 0 }}" min="0" max="20">
                                    </td>
                                    <td>
                                        <input type="number" name="player_{{ player.id }}_interceptions" 
                                            class="form-control form-control-sm text-center" 
                                            value="{{ stat.interceptions if stat else 0 }}" min="0" max="10">
                                    </td>
                                    <td class="text-center">
                                        <input type="checkbox" name="player_{{ player.id }}_mvp" 
                                            class="form-check-input" 
                                            {% if stat and stat.is_mvp %}checked{% endif %}>
                                    </td>
                                    <td>
                                        <select name="player_{{ player.id }}_injury" class="form-select form-select-sm">
                                            <option value="">{% if get_locale() == 'es' %}Ninguna{% else %}None{% endif %}</option>
                                            <option value="badly_hurt" {% if stat and stat.injury_result == 'badly_hurt' %}selected{% endif %}>{% if get_locale() == 'es' %}Mal Herido{% else %}Badly Hurt{% endif %}</option>
                                            <option value="miss_next_game" {% if stat and stat.injury_result == 'miss_next_game' %}selected{% endif %}>{% if get_locale() == 'es' %}Pierde Partido{% else %}MNG{% endif %}</option>
                                            <option value="niggling" {% if stat and stat.injury_result == 'niggling' %}selected{% endif %}>{% if get_locale() == 'es' %}Lesión Persistente{% else %}Niggling{% endif %}</option>
                                            <option value="-1ma" {% if stat and stat.injury_result == '-1ma' %}selected{% endif %}>-1 MA</option>
                                            <option value="-1av" {% if stat and stat.injury_result == '-1av' %}selected{% endif %}>-1 AV</option>
                                            <option value="-1ag" {% if stat and stat.injury_result == '-1ag' %}selected{% endif %}>-1 AG</option>
                                            <option value="-1st" {% if stat and stat.injury_result == '-1st' %}selected{% endif %}>-1 ST</option>
                                            <option value="dead" {% if stat and stat.injury_result == 'dead' %}selected{% endif %}>{% if get_locale() == 'es' %}Muerto{% else %}Dead{% endif %}</option>
                                        </select>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="d-flex gap-2 mt-4">
        <button type="submit" class="btn btn-primary btn-lg">
            <i class="bi bi-check-lg me-1"></i>{% if get_locale() == 'es' %}Guardar Estadísticas{% else %}Save Player Stats{% endif %}
        </button>
        <a href="{{ url_for('matches.view', match_id=match.id) }}" class="btn btn-outline-secondary btn-lg">{% if get_locale() == 'es' %}Omitir / Cancelar{% else %}Skip / Cancel{% endif %}</a>
    </div>
</form>

<div class="card mt-4">
    <div class="card-header">
        <i class="bi bi-info-circle me-2"></i>{% if get_locale() == 'es' %}Referencia de PEJ (Puntos de Estrella del Jugador){% else %}SPP Reference{% endif %}
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-6">
                <table class="table table-sm mb-0">
                    <tr><td>{% if get_locale() == 'es' %}Touchdown (TD){% else %}Touchdown (TD){% endif %}</td><td class="text-end text-gold">+3 {% if get_locale() == 'es' %}PEJ{% else %}SPP{% endif %}</td></tr>
                    <tr><td>{% if get_locale() == 'es' %}Baja (BAJ){% else %}Casualty (CAS){% endif %}</td><td class="text-end text-gold">+2 {% if get_locale() == 'es' %}PEJ{% else %}SPP{% endif %}</td></tr>
                    <tr><td>{% if get_locale() == 'es' %}Intercepción (INT){% else %}Interception (INT){% endif %}</td><td class="text-end text-gold">+2 {% if get_locale() == 'es' %}PEJ{% else %}SPP{% endif %}</td></tr>
                </table>
            </div>
            <div class="col-md-6">
                <table class="table table-sm mb-0">
                    <tr><td>{% if get_locale() == 'es' %}Pase Completado (PAS){% else %}Completion (CMP){% endif %}</td><td class="text-end text-gold">+1 {% if get_locale() == 'es' %}PEJ{% else %}SPP{% endif %}</td></tr>
                    <tr><td>{% if get_locale() == 'es' %}Deflexión (DEF){% else %}Deflection (DEF){% endif %}</td><td class="text-end text-gold">+1 {% if get_locale() == 'es' %}PEJ{% else %}SPP{% endif %}</td></tr>
                    <tr><td>{% if get_locale() == 'es' %}Premio MVP{% else %}MVP Award{% endif %}</td><td class="text-end text-gold">+4 {% if get_locale() == 'es' %}PEJ{% else %}SPP{% endif %}</td></tr>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}
